= Model Context Protocol (MCP)

TIP: **New to MCP?** Start with our xref:guides/getting-started-mcp.adoc[Getting Started with MCP] guide for a quick introduction and hands-on examples.

The link:https://modelcontextprotocol.org/docs/concepts/architecture[Model Context Protocol] (MCP) is a standardized protocol that enables AI models to interact with external tools and resources in a structured way.
Think of it as a bridge between your AI models and the real world - allowing them to access databases, APIs, file systems, and other external services through a consistent interface.
It supports multiple transport mechanisms to provide flexibility across different environments.

The link:https://modelcontextprotocol.io/sdk/java/mcp-overview[MCP Java SDK] provides a Java implementation of the Model Context Protocol, enabling standardized interaction with AI models and tools through both synchronous and asynchronous communication patterns.

Spring AI embraces MCP with comprehensive support through dedicated Boot Starters and MCP Java Annotations, making it easier than ever to build sophisticated AI-powered applications that can seamlessly connect to external systems.
This means Spring developers can participate in both sides of the MCP ecosystem - building AI applications that consume MCP servers and creating MCP servers that expose Spring-based services to the wider AI community.
Bootstrap your AI applications with MCP support using link:https://start.spring.io[Spring Initializer].

== MCP Java SDK Architecture

TIP: This section provides an overview for the link:https://modelcontextprotocol.io/sdk/java/mcp-overview[MCP Java SDK architecture]. 
For the Spring AI MCP integration, refer to the xref:#_spring_ai_mcp_integration[Spring AI MCP Boot Starters] documentation.

The Java MCP implementation follows a three-layer architecture that separates concerns for maintainability and flexibility:

.MCP Stack Architecture
image::mcp/mcp-stack.svg[MCP Stack Architecture, align=center]

=== Client/Server Layer (Top)

The top layer handles the main application logic and protocol operations:

* *McpClient* - Manages client-side operations and server connections
* *McpServer* - Handles server-side protocol operations and client requests
* Both components utilize the session layer below for communication management

=== Session Layer (Middle)

The middle layer manages communication patterns and maintains connection state:

* *McpSession* - Core session management interface
* *McpClientSession* - Client-specific session implementation
* *McpServerSession* - Server-specific session implementation

=== Transport Layer (Bottom)

The bottom layer handles the actual message transport and serialization:

* *McpTransport* - Manages JSON-RPC message serialization and deserialization
* Supports multiple transport implementations (STDIO, HTTP/SSE, Streamable-HTTP, etc.)
* Provides the foundation for all higher-level communication

|===
| link:https://modelcontextprotocol.io/sdk/java/mcp-client[MCP Client] |

a| The MCP Client is a key component in the Model Context Protocol (MCP) architecture, responsible for establishing and managing connections with MCP servers. It implements the client-side of the protocol, handling:

* Protocol version negotiation to ensure compatibility with servers
* Capability negotiation to determine available features
* Message transport and JSON-RPC communication
* Tool discovery and execution
* Resource access and management
* Prompt system interactions
* Optional features:
** Roots management
** Sampling support
* Synchronous and asynchronous operations
* Transport options:
** Stdio-based transport for process-based communication
** Java HttpClient-based SSE client transport
** WebFlux SSE client transport for reactive HTTP streaming

^a| image::mcp/java-mcp-client-architecture.jpg[Java MCP Client Architecture, width=500]
|===

|===
| link:https://modelcontextprotocol.io/sdk/java/mcp-server[MCP Server] |

a| The MCP Server is a foundational component in the Model Context Protocol (MCP) architecture that provides tools, resources, and capabilities to clients. It implements the server-side of the protocol, responsible for:

* Server-side protocol operations implementation
** Tool exposure and discovery
** Resource management with URI-based access
** Prompt template provision and handling
** Capability negotiation with clients
** Structured logging and notifications
* Concurrent client connection management
* Synchronous and Asynchronous API support
* Transport implementations:
** Stdio, Streamable-HTTP, Stateless Streamable-HTTP, SSE

^a| image::mcp/java-mcp-server-architecture.jpg[Java MCP Server Architecture, width=600]
|===

For detailed implementation guidance, using the low-level MCP Client/Server APIs, refer to the link:https://modelcontextprotocol.io/sdk/java/mcp-overview[MCP Java SDK documentation].
For simplified setup using Spring Boot, use the MCP Boot Starters described below.

== Spring AI MCP Integration

Spring AI provides MCP integration through the following Spring Boot starters:

=== link:mcp-client-boot-starter-docs.html[Client Starters]

* `spring-ai-starter-mcp-client` - Core starter providing `STDIO`, Servlet-based `Streamable-HTTP`, `Stateless Streamable-HTTP` and `SSE` support
* `spring-ai-starter-mcp-client-webflux` - WebFlux-based  `Streamable-HTTP`, `Stateless Streamable-HTTP` and `SSE` transport implementation

=== link:mcp-server-boot-starter-docs.html[Server Starters]

==== STDIO

[options="header"]
|===
|Server Type | Dependency | Property
| xref:api/mcp/mcp-stdio-sse-server-boot-starter-docs.adoc[Standard Input/Output (STDIO)] | `spring-ai-starter-mcp-server` | `spring.ai.mcp.server.stdio=true`
|===

==== WebMVC

|===
|Server Type | Dependency | Property
| xref:api/mcp/mcp-stdio-sse-server-boot-starter-docs.adoc#_sse_webmvc_serve[SSE WebMVC] | `spring-ai-starter-mcp-server-webmvc` | `spring.ai.mcp.server.protocol=SSE` or empty
| xref:api/mcp/mcp-streamable-http-server-boot-starter-docs.adoc#_streamable_http_webmvc_server[Streamable-HTTP WebMVC] | `spring-ai-starter-mcp-server-webmvc` | `spring.ai.mcp.server.protocol=STREAMABLE`
| xref:api/mcp/mcp-stateless-server-boot-starter-docs.adoc#_stateless_webmvc_server[Stateless Streamable-HTTP WebMVC] | `spring-ai-starter-mcp-server-webmvc` | `spring.ai.mcp.server.protocol=STATELESS`
|===

==== WebMVC (Reactive)
|===
|Server Type | Dependency | Property
| xref:api/mcp/mcp-stdio-sse-server-boot-starter-docs.adoc#_sse_webflux_serve[SSE WebFlux] | `spring-ai-starter-mcp-server-webflux` | `spring.ai.mcp.server.protocol=SSE` or empty
| xref:api/mcp/mcp-streamable-http-server-boot-starter-docs.adoc#_streamable_http_webflux_server[Streamable-HTTP WebFlux] | `spring-ai-starter-mcp-server-webflux` | `spring.ai.mcp.server.protocol=STREAMABLE`
| xref:api/mcp/mcp-stateless-server-boot-starter-docs.adoc#_stateless_webflux_server[Stateless Streamable-HTTP WebFlux] | `spring-ai-starter-mcp-server-webflux` | `spring.ai.mcp.server.protocol=STATELESS`
|===

== xref:api/mcp/mcp-annotations-overview.adoc[Spring AI MCP Annotations]

In addition to the programmatic MCP client & server configuration, Spring AI provides annotation-based method handling for MCP servers and clients through the xref:api/mcp/mcp-annotations-overview.adoc[MCP Annotations] module. 
This approach simplifies the creation and registration of MCP operations using a clean, declarative programming model with Java annotations.

The MCP Annotations module enables developers to:

* Create MCP tools, resources, and prompts using simple annotations
* Handle client-side notifications and requests declaratively
* Reduce boilerplate code and improve maintainability
* Automatically generate JSON schemas for tool parameters
* Access special parameters and context information

Key features include:   

* xref:api/mcp/mcp-annotations-server.adoc[Server Annotations]: `@McpTool`, `@McpResource`, `@McpPrompt`, `@McpComplete`
* xref:api/mcp/mcp-annotations-client.adoc[Client Annotations]: `@McpLogging`, `@McpSampling`, `@McpElicitation`, `@McpProgress`
* xref:api/mcp/mcp-annotations-special-params.adoc[Special Parameters]: `McpSyncServerExchange`, `McpAsyncServerExchange`, `McpTransportContext`, `McpMeta`
* *Automatic Discovery*: Annotation scanning with configurable package inclusion/exclusion
* *Spring Boot Integration*: Seamless integration with MCP Boot Starters

== Upgrading to Spring AI 2.0

Starting with **Spring AI 2.0**, the Spring-specific MCP transport implementations (`mcp-spring-webflux` and `mcp-spring-webmvc`) are no longer shipped by the MCP Java SDK. They have been moved into the Spring AI project itself. This is a breaking change that requires dependency and import updates for applications that directly reference these transport artifacts or classes.

=== Maven Dependency Group ID Change

The `mcp-spring-webflux` and `mcp-spring-webmvc` artifacts have moved from the `io.modelcontextprotocol.sdk` group to `org.springframework.ai`.

.Before (MCP Java SDK < 1.0.x and Spring AI < 2.0.x)
[source,xml]
----
<dependency>
    <groupId>io.modelcontextprotocol.sdk</groupId>
    <artifactId>mcp-spring-webflux</artifactId>
</dependency>

<dependency>
    <groupId>io.modelcontextprotocol.sdk</groupId>
    <artifactId>mcp-spring-webmvc</artifactId>
</dependency>
----

.After (MCP Java SDK >= 1.0.x and Spring AI >= 2.0.x)
[source,xml]
----
<dependency>
    <groupId>org.springframework.ai</groupId>
    <artifactId>mcp-spring-webflux</artifactId>
</dependency>

<dependency>
    <groupId>org.springframework.ai</groupId>
    <artifactId>mcp-spring-webmvc</artifactId>
</dependency>
----

NOTE: When using the `spring-ai-bom` or the Spring AI starter dependencies (`spring-ai-starter-mcp-server-webflux`, `spring-ai-starter-mcp-server-webmvc`, `spring-ai-starter-mcp-client-webflux`) **no explicit version is needed** â€” the BOM manages it automatically.

=== Java Package Relocation

All transport classes have been relocated to `org.springframework.ai` packages.

.Server transport classes
|===
|Class |Old package (MCP SDK) |New package (Spring AI)

|`WebFluxSseServerTransportProvider`
|`io.modelcontextprotocol.server.transport`
|`org.springframework.ai.mcp.server.webflux.transport`

|`WebFluxStreamableServerTransportProvider`
|`io.modelcontextprotocol.server.transport`
|`org.springframework.ai.mcp.server.webflux.transport`

|`WebFluxStatelessServerTransport`
|`io.modelcontextprotocol.server.transport`
|`org.springframework.ai.mcp.server.webflux.transport`

|`WebMvcSseServerTransportProvider`
|`io.modelcontextprotocol.server.transport`
|`org.springframework.ai.mcp.server.webmvc.transport`

|`WebMvcStreamableServerTransportProvider`
|`io.modelcontextprotocol.server.transport`
|`org.springframework.ai.mcp.server.webmvc.transport`

|`WebMvcStatelessServerTransport`
|`io.modelcontextprotocol.server.transport`
|`org.springframework.ai.mcp.server.webmvc.transport`
|===

.Client transport classes
|===
|Class |Old package (MCP SDK) |New package (Spring AI)

|`WebFluxSseClientTransport`
|`io.modelcontextprotocol.client.transport`
|`org.springframework.ai.mcp.client.webflux.transport`

|`WebClientStreamableHttpTransport`
|`io.modelcontextprotocol.client.transport`
|`org.springframework.ai.mcp.client.webflux.transport`
|===

.Example import update
[source,java]
----
// Before
import io.modelcontextprotocol.server.transport.WebFluxSseServerTransportProvider;
import io.modelcontextprotocol.server.transport.WebMvcSseServerTransportProvider;
import io.modelcontextprotocol.client.transport.WebFluxSseClientTransport;
import io.modelcontextprotocol.client.transport.WebClientStreamableHttpTransport;

// After
import org.springframework.ai.mcp.server.webflux.transport.WebFluxSseServerTransportProvider;
import org.springframework.ai.mcp.server.webmvc.transport.WebMvcSseServerTransportProvider;
import org.springframework.ai.mcp.client.webflux.transport.WebFluxSseClientTransport;
import org.springframework.ai.mcp.client.webflux.transport.WebClientStreamableHttpTransport;
----

=== MCP SDK Version Requirement

Spring AI 2.0 requires **MCP Java SDK 1.0.0** (RC1 or later). The SDK version has been bumped from `0.18.x` to the `1.0.x` release line. Update your BOM or explicit version accordingly.

=== Spring Boot Auto-configuration Users

If you rely **exclusively on Spring Boot auto-configuration** via the Spring AI starters, you do **not** need to change any Java code. The auto-configurations have already been updated internally to reference the new packages. Only update your `pom.xml`/`build.gradle` dependency coordinates as described above.

== Additional Resources

* xref:api/mcp/mcp-annotations-overview.adoc[MCP Annotations Documentation]
* link:mcp-client-boot-starter-docs.html[MCP Client Boot Starters Documentation]
* link:mcp-server-boot-starter-docs.html[MCP Server Boot Starters Documentation]
* link:mcp-helpers.html[MCP Utilities Documentation]
* link:https://modelcontextprotocol.github.io/specification/[Model Context Protocol Specification]
